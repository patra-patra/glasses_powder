<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Каталог товаров</title>
  <style>
    .catalog {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 20px;
    }

    .product-card {
      border: 1px solid #ccc;
      padding: 10px;
      width: 200px;
      text-align: center;
      border-radius: 8px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
    }

    .product-card img {
      max-width: 100%;
      height: auto;
    }

    .product-name {
      font-weight: bold;
      margin-top: 10px;
    }

    .product-price {
      color: #28a745;
      font-weight: bold;
    }

    .add-to-cart {
      margin-top: 10px;
      padding: 5px 10px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    .add-to-cart:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

<h2 style="text-align: center;">Каталог товаров</h2>
<!-- Кнопка добавления товара -->
<a href="{{ url_for('basket') }}">Корзина (<span id="basket-count">0</span>)</a>


<div style="display: flex; flex-wrap: wrap; gap: 20px;">
    {% for product in products %}

        <div style="border: 1px solid #ccc; padding: 10px; width: 200px; text-align: center;">
            {% set is_cosmetic = product.id >= 1000 %}
            {% if is_cosmetic %}
                <img src="{{ url_for('static', filename='img/photo_cosm/' ~ product.photonum) }}"
                     alt="{{ product.name }}"
                     style="width: 150px; height: auto;">
            {% else %}
                <img src="{{ url_for('static', filename='img/photo_glasses/' ~ product.photonum) }}"
                     alt="{{ product.name }}"
                     style="width: 150px; height: auto;">
            {% endif %}

            <h4>{{ product.name }}</h4>
            <p>{{ product.description }}</p>
            <button onclick="addToBasket({{ product.id }})">Добавить в корзину</button>
        </div>
    {% endfor %}
</div>


</body>
<script>
function addToBasket(productId) {
    fetch('/add_to_cart/' + productId, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            updateBasketCount();
        });
}

function updateBasketCount() {
    fetch('/basket_count')
        .then(response => response.json())
        .then(data => {
            document.getElementById('basket-count').innerText = data.count;
        });
}

document.addEventListener('DOMContentLoaded', updateBasketCount);
</script>

</html>
